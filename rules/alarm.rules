rule "Antifurto cambio stato"
when 
    Item Prodino0_optoIn0 changed
then
  if(Prodino0_optoIn0.state == "INSERITO") {
      val telegramActions = getActions("telegram","telegram:telegramBot:Telegram_Bot")
      telegramActions.sendTelegram("Antifurto INSerito!")
      if (DaikinACUnit_Mode_Studio.state == "HEAT" && DaikinACUnit_Power_Studio.state == ON)
      {
          DaikinACUnit_Power_Studio.sendCommand(OFF)
          telegramActions.sendTelegram("Condizionatore Studio spento")
      }
      if (DaikinACUnit_Mode_Soggiorno.state == "HEAT" && DaikinACUnit_Power_Soggiorno.state == ON)
      {
          DaikinACUnit_Power_Soggiorno.sendCommand(OFF)
          telegramActions.sendTelegram("Condizionatore Soggiorno spento")
      }
      if (DaikinACUnit_Mode_Cameretta.state == "HEAT" && DaikinACUnit_Power_Cameretta.state == ON)
      {
          DaikinACUnit_Power_Cameretta.sendCommand(OFF)
          telegramActions.sendTelegram("Condizionatore Cameretta spento")
      }
      if (DaikinACUnit_Mode_Letto.state == "HEAT" && DaikinACUnit_Power_Letto.state == ON)
      {
          DaikinACUnit_Power_Letto.sendCommand(OFF)
          telegramActions.sendTelegram("Condizionatore Letto spento")
      }
      if (TapparellaLettoPosition.state > 0)
      {
        TapparellaLettoPosition.sendCommand(0)
      }
      if (TapparellaStudioPosition.state > 0)
      {
        TapparellaStudioPosition.sendCommand(0)
      }  
    // mailActions.sendMail("massimiliano.casini@gmail.com","Antifurto", "Antifurto INSERITO")
  }
  else if(Prodino0_optoIn0.state == "DISINSERITO") {
      val telegramActions = getActions("telegram","telegram:telegramBot:Telegram_Bot")
      telegramActions.sendTelegram("Antifurto DIsInserito!")
    // mailActions.sendMail("massimiliano.casini@gmail.com","Antifurto", "Antifurto DISINSERITO")
        if (SunElevation.state > -3 && now.getHour > 8) {
          TapparellaLettoPosition.sendCommand(100)
          TapparellaStudioPosition.sendCommand(100)
        }
  }
end
rule "Allarme antifurto"
when
    Item Prodino0_optoIn1 changed
then
  val pushoverActions = getActions("pushover", "pushover:pushover-account:account")
  val telegramActions = getActions("telegram","telegram:telegramBot:Telegram_Bot")
  if(Prodino0_optoIn1.state == "ALLARME") {
    var receipt = pushoverActions.sendPriorityMessage("Allarme antifurto", "openhab3", 2)
    telegramActions.sendTelegram("Allarme antifurto")
    // wait for your cancel condition
        if( receipt !== null ) {
            pushoverActions.cancelPriorityMessage(receipt)
            receipt = null
        }
  }
  else if (Prodino0_optoIn1.state == "RIPOSO") {
      pushoverActions.sendMessage("FINE Allarme antifurto", "openhab3")
      telegramActions.sendTelegram("FINE Allarme antifurto")
  }
end

rule "Chudi tapparelle prima di inserimento automatico"
when
Time cron "0 00 00 ? * * *"
then
      TapparellaLettoPosition.sendCommand(0)
      TapparellaStudioPosition.sendCommand(0)
end